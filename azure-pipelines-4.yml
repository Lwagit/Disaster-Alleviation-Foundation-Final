trigger:
  branches:
    include:
      - main   # or your default branch

pool:
  vmImage: 'windows-latest'

variables:
  azureSubscription: '<YOUR AZURE SERVICE CONNECTION NAME>'  # e.g., GiftofGivers-Connection
  appName: 'GiftofGivers-Web'
  resourceGroup: 'AZ-JHB-RSG-RCGPBR-ST10406108-TER'
  appServicePlan: 'ASP-AZJHBRSGRCGPBRST10406108TER-b4ee'
  buildConfiguration: 'Release'

stages:
- stage: Build
  displayName: 'Build Stage'
  jobs:
  - job: Build
    displayName: 'Build Job'
    steps:
    - task: UseDotNet@2
      inputs:
        packageType: 'sdk'
        version: '8.0.x'  # match your .NET version
    - task: NuGetToolInstaller@1
    - task: NuGetCommand@2
      inputs:
        restoreSolution: '**/*.sln'
    - task: VSBuild@1
      inputs:
        solution: '**/*.sln'
        msbuildArgs: '/p:Configuration=$(buildConfiguration)'
        platform: 'Any CPU'
        configuration: '$(buildConfiguration)'
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)'
        ArtifactName: 'drop'
        publishLocation: 'Container'

- stage: Deploy
  displayName: 'Deploy Stage'
  dependsOn: Build
  jobs:
  - deployment: DeployWeb
    displayName: 'Deploy Web App'
    environment: 'Production'
    strategy:
      runOnce:
        deploy:
          steps:
          - task: AzureWebApp@1
            inputs:
              azureSubscription: 'ADvTECH-Tertiary Rosebank College'
              appType: 'webApp'
              appName: 'GiftofGivers-Web'
              package: '$(Pipeline.Workspace)/drop/**/*.zip'
              resourceGroupName: '$(resourceGroup)'
